<?php


namespace App\Controllers;


use App\Models\Users;
use Core\Auth;
use Core\Controller;
use Core\DAO;
use Core\Flash;
use Core\View;

class Register extends Controller
{
    /**
     * Show the signup page
     *
     * @return void
     */
    public function indexAction()
    {
        if(Auth::isLoggedIn()){
            $this->redirect("/");
        }
        View::renderTemplate('Register/register.twig');
    }

    /**
     * Sign up a new user
     *
     * @return void
     */
    public function createAction()
    {
        $this->requireCaptcha('/register');
        try {
            $user = new Users($_POST);
            $em = DAO::getEntityManager();
            $em->persist($user);
            $em->flush();
            $this->redirect('/register/success');
        }catch (\Exception $e){
            Flash::addMessage($e->getMessage(), Flash::WARNING);
            $this->redirect("/register");
        }
    }

    /**
     * Show the signup success page
     *
     * @return void
     */
    public function successAction()
    {
        Flash::addMessage("All done! You can login with us now!");
        $this->redirect('/login');
//        View::renderTemplate('Register/success.twig');
    }
}