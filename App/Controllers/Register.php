<?php


namespace App\Controllers;


use Core\Controller;
use Core\DAO;
use Core\View;
use App\Models\Users;

class Register extends Controller
{
    /**
     * Show the signup page
     *
     * @return void
     */
    public function indexAction()
    {
        View::renderTemplate('Register/register.twig');
    }

    /**
     * Sign up a new user
     *
     * @return void
     */
    public function createAction()
    {
        $user = new Users($_POST);
        $em = DAO::getEntityManager();
        try {
            $em->persist($user);
            $em->flush();
            $this->redirect('/register/success');
        }catch (\Exception $e){
            echo $e->getMessage();
            echo $e->getTraceAsString();
            View::renderTemplate('Register/register.twig', [
                'username' => $user->getUsername(),
                'error' => 'There\'s an error, please try again'
            ]);
        }
    }

    /**
     * Show the signup success page
     *
     * @return void
     */
    public function successAction()
    {
        $this->redirect('/login');
//        View::renderTemplate('Register/success.twig');
    }
}