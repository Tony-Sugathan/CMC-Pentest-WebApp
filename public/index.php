<?php
/**
 * Front controller
 */

/**
 * Twig
 */
require_once __DIR__.'/../vendor/autoload.php';

$loader = new \Twig\Loader\FilesystemLoader(__DIR__.'/../App/Views');
$twig = new \Twig\Environment($loader);
use Core\Router;
/**
 * Env
 */
$dotenv = Dotenv\Dotenv::createImmutable(__DIR__.'/../config');
$dotenv->load();

/**
 * Router
 */
Router::add('', ['controller' => 'Home', 'action' => 'index']);
//Router::add('users', ['controller' => 'Users', 'action' => 'index']);
//$router->add('users/new',['controller'=>'Users', 'action'=>'new']);
Router::add('{controller}/{action}');
Router::add('{controller}', ['action' => 'index']);
//Router::add('{controller}/', ['action' => 'index']);
Router::add('admin/{controller}/{action}', ['namespace' => 'Admin']);
Router::add('admin/{controller}/{id:\d+}/{action:edit|remove|enable}', ['namespace' => 'Admin']);
Router::add('{controller}/{id:\d+}/{action}');
Router::add('{controller}/{id:\d+}', ['action' => 'index']);
//Router::add('{controller}/{id:\d+}/', ['action' => 'index']);

/**
 * Error and Exception handling
 */
set_error_handler('Core\Error::errorHandler');
set_exception_handler('Core\Error::exceptionHandler');

/**
 * Sessions
 */
session_start();

Router::dispatch($_SERVER["QUERY_STRING"]);

function displayRoutes($router){
    echo '<pre>';
    echo htmlspecialchars(print_r($router->getRoutes(), true));
    echo '</pre>';
//
}

function displayRouteInfo($router){
    $url = $_SERVER["QUERY_STRING"];
    if($router->match($url)){
        echo '<pre>';
        var_dump($router->getParams());
        echo '</pre>';
    }else {
        echo "No route found for: ".$url;
    }
}